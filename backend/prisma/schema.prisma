generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
  SUPERADMIN
}

model User {
  id           String    @id @default(auto()) @map("_id") @db.ObjectId
  email        String    @unique
  passwordHash String
  name         String     
  age          Int
  role         Role    @default(USER)
  phoneNumber  String   @unique
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  refreshToken String?
  comments     Comment[]
  orders       Order[]
  likes        Like[]
  score        Int       @default(0)
  projects     Project[]
  wallet                  Wallet?      
  walletId                String?     @db.ObjectId  @unique
  scoreHistory    ScoreHistory[]

}

type ScoreHistory{
  time DateTime
  updatedScore Int
}

//Projects

model ProjectCategory {
  id       String    @id @default(auto()) @map("_id") @db.ObjectId
  name     String    @unique
  icon     String
  projects Project[]
}

model Project {
  id          String            @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  description String
  startDate   DateTime
  endDate     DateTime
  thumbnail   String
  likes       Like[]
  comments    Comment[]
  video       Video             
  materials   ProjectMaterial[]
  userId      String            @db.ObjectId @unique
  user        User              @relation(fields: [userId], references: [id],onDelete: Cascade)
  categoryId  String            @db.ObjectId  @unique
  category    ProjectCategory   @relation(fields: [categoryId], references: [id])
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
}

type Video{
  url String
  uploadedAt String?
}



type ProjectMaterial {
  productId String  @db.ObjectId
  name      String?
  quantity  Int
}


model Comment {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  commentedBy   User     @relation(fields: [commentedById], references: [id],onDelete: Cascade)
  commentedById String   @db.ObjectId @unique
  content       String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  project       Project  @relation(fields: [projectId], references: [id],onDelete: Cascade)
  projectId     String   @db.ObjectId @unique
  @@unique([projectId, commentedById])
}

model Like {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  likedBy      User     @relation(fields: [likedById], references: [id],onDelete: Cascade)
  likedById    String   @db.ObjectId 
  createdAt DateTime @default(now())
  project   Project  @relation(fields: [projectId], references: [id],onDelete: Cascade)
  projectId String   @db.ObjectId

  @@unique([projectId, likedById])
}



//ecom 

model ProductCategory {
  id       String    @id @default(auto()) @map("_id") @db.ObjectId
  name     String    @unique
  icon     String
  products Product[]
}


model Product {
  id               String            @id @default(auto()) @map("_id") @db.ObjectId
  name             String
  description      String
  price            Float
  inventory        Int
  categoryId       String           @db.ObjectId
  category         ProductCategory  @relation(fields: [categoryId], references: [id],onDelete: Cascade)
  images           String[]
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  projectMaterials ProjectMaterial[]
}

model Order {
  id            String         @id @default(auto()) @map("_id") @db.ObjectId
  userId        String         @db.ObjectId @unique
  products      OrderProduct[]
  totalAmount   Float
  paymentStatus PaymentStatus   @default(PENDING)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  transaction    Transaction    @relation(fields: [transactionId], references: [id])
  transactionId  String         @db.ObjectId  @unique
  deliveryAddress String?


  user User @relation(fields: [userId], references: [id],onDelete: Cascade)
}

type OrderProduct {
  productId String @db.ObjectId
  quantity  Int
}


enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
}

model Wallet {
  id           String        @id @default(auto()) @map("_id") @db.ObjectId
  userId      String            @db.ObjectId @unique
  user        User              @relation(fields: [userId],references: [id],onDelete: Cascade)
  balance      Float         @default(0.0)
  transactions Transaction[]

}

model Transaction {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  walletId  String   @db.ObjectId @unique
  order      Order?   
  amount    Float
  type      TransactionType
  status      PaymentStatus?
  createdAt DateTime @default(now())

  wallet Wallet @relation(fields: [walletId], references: [id],onDelete: Cascade)
}

enum TransactionType {
  DEBIT
  CREDIT
}